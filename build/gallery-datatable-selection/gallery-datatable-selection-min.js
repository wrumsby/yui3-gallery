YUI.add("gallery-datatable-selection",function(b){function a(){}a.ATTRS={highlighted:{value:null,validator:function(c){return(c instanceof b.Node)||c===null;}},selected:{value:null,validator:function(c){return(c instanceof b.Node)||c===null;}},highlightMode:{value:null,setter:"_setHighlightMode",validator:function(c){if(!b.Lang.isString(c)){return false;}return(c===null||c==="cell"||c==="row")?true:false;}},selectionMode:{value:null,setter:"_setSelectionMode",validator:function(c){if(!b.Lang.isString(c)){return false;}return(c===null||c==="cell"||c==="row")?true:false;}},selectedRows:{value:[],validator:b.Lang.isArray,getter:"_getSelectedRows",setter:"_setSelectedRows"},selectedCells:{value:[],validator:b.Lang.isArray,setter:"_setSelectedCells",getter:"_getSelectedCells"},selectionMulti:{value:false,setter:"_setSelectionMulti",validator:b.Lang.isBoolean}};b.mix(a.prototype,{_selections:null,_classHighlight:null,_classSelected:null,_clickModifiers:null,initializer:function(){this._bindSelector();},destructor:function(){this._unbindSelector();},enableSelection:function(){this.disableSelection();this._bindSelector();},disableSelection:function(){this.clearAll();this._unbindSelector();},getColumnByTd:function(c){var d=this.getColumnNameByTd(c);return(d)?this.getColumn(d):null;},getColumnNameByTd:function(c){var d=c.get("className").split(" "),f=new RegExp(this.getClassName("col")+"-(.*)");var e;b.Array.some(d,function(g){var h=g.match(f);if(h&&b.Lang.isArray(h)&&h[1]){e=h[1];return true;}});return e||null;},getSelectedTds:function(){var c=[];b.Array.each(this._selections,function(d){if(d.get("tagName").toLowerCase()==="td"){c.push(d);}else{if(d.get("tagName").toLowerCase()==="tr"){var e=d.all("td");if(e){e.each(function(f){c.push(f);});}}}});return c;},clearSelections:function(){this._selections=[];this.set("selected",null);this._clearAll(this._classSelected);},clearHighlighted:function(){this.set("highlighted",null);this._clearAll(this._classHighlight);},clearAll:function(){this.clearSelections();this.clearHighlighted();},_unbindSelector:function(){b.Array.each(this._eventHandles.selector,function(c){c.detach();});this._eventHandles.selector=null;if(this._eventHandles.selectorSelect){this._eventHandles.selectorSelect.detach();}this._eventHandles.selectorSelect=null;this._clickModifiers=null;},_bindSelector:function(){this._selections=[];this._eventHandles.selector=[];this._eventHandles.selector.push(this.on("highlightedChange",this._highlightChange));this._eventHandles.selector.push(this.on("selectedChange",this._selectedChange));this._classHighlight=this.getClassName("sel","highlighted");this._classSelected=this.getClassName("sel","selected");this._eventHandles.selector.push(this.data.before("*:reset",b.bind("_beforeResetDataSelect",this)));this._eventHandles.selector.push(this.data.after("*:reset",b.bind("_afterResetDataSelect",this)));this._clickModifiers={ctrlKey:null,altKey:null,metaKey:null,shiftKey:null,which:null,button:null};},_highlightChange:function(d){var c=this._processNodeAction(d,"highlight",true);},_selectedChange:function(g){var e,f;if(b.UA.os.search("macintosh")===0){e=this.get("selectionMulti")===true&&this._clickModifiers.metaKey===true;}else{e=this.get("selectionMulti")===true&&this._clickModifiers.ctrlKey===true;}f=this.get("selectionMulti")===true&&this._clickModifiers.shiftKey===true;this._clearDOMSelection();if(!e&&!f&&this._selections.length>1){this.clearSelections();}if(f){this._processRange(g);}else{var c=this._processNodeAction(g,"select",!e);if(!e){this._selections=[];}this._selections.push(c);}this.fire("selected",{ochange:g,record:this.getRecord(g.newVal)});var d={selectionMode:this.get("selectionMode")};if(this.get("selectionMode").toLowerCase()==="cell"){d["cells"]=this.get("selectedCells");}else{if(this.get("selectionMode").toLowerCase()==="row"){d["rows"]=this.get("selectedRows");}}this.fire("selection",d);},_processRange:function(s){var f=s.newVal,r=s.prevVal||null;if(f&&r){var h=this.getRecord(f),q=this.data.indexOf(h),e=this.getColumnNameByTd(f),v=b.Array.indexOf(this.get("columns"),this.getColumn(e)),n=this.getRecord(r),x=this.data.indexOf(n),l=this.getColumnNameByTd(r),p=b.Array.indexOf(this.get("columns"),this.getColumn(l));var g=v-p,k=q-x;if(g!==null&&k!==null){if(b.Lang.isArray(this._selections)){this.clearSelections();}if(this.get("selectionMode")==="cell"){var m=(g<0)?-1:1,w=(k<0)?-1:1,d=r;for(var t=0;t<=Math.abs(k);t++){for(var u=0;u<=Math.abs(g);u++){d=this.getCell(r,[w*(t),m*(u)]);if(d){d.addClass(this._classSelected);this._selections.push(d);}}}}else{if(this.get("selectionMode")==="row"){var w=(k<0)?-1:1,c=this.getRow(x);for(var t=0;t<=Math.abs(k);t++){c=this.getRow(x+w*(t));if(c){c.addClass(this._classSelected);this._selections.push(c);}}}}}}},_getSelectedRows:function(){var c=[],e=[],d,f;b.Array.each(this._selections,function(g){d=(g.get("tagName").toLowerCase()==="tr")?g:g.ancestor("tr");if(d.get("tagName").toLowerCase()==="tr"&&c.indexOf(d)===-1){f=this.data.getByClientId(d.getData("yui3-record"));c.push(d);e.push({tr:d,record:f,recordIndex:this.data.indexOf(f)});}},this);return e;},_getSelectedCells:function(){var d=[],f=this.get("columns"),c,e,g;b.Array.each(this._selections,function(h){if(!h){return;}if(h.get("tagName").toLowerCase()==="td"){c=this.getColumnByTd(h);e=h.ancestor("tr");g=this.data.getByClientId(e.getData("yui3-record"));d.push({td:h,record:g,recordIndex:this.data.indexOf(g),column:c,columnName:c.key||c.name,columnIndex:b.Array.indexOf(f,c)});}else{if(h.get("tagName").toLowerCase()==="tr"){e=h;g=this.data.getByClientId(e.getData("yui3-record"));var i=e.all("td");if(i){i.each(function(j){c=this.getColumnByTd(j);d.push({td:j,record:g,recordIndex:this.data.indexOf(g),column:c,columnName:c.key||c.name,columnIndex:b.Array.indexOf(f,c)});},this);}}}},this);return d;},_setSelectedCells:function(c){this._selections=[];if(b.Lang.isArray(c)&&this.data.size()>c.length){b.Array.each(c,function(f){var g,d,h;if(f.record){g=this.getRow(f.record);
}if(f.column){d=this.getColumn(f.column);}if(g&&d){var e=d.key||d.name;if(e){h=g.one("."+this.getClassName("col")+"-"+e);this._selections.push(h);h.addClass(this._classSelected);}}},this);}return c;},_setSelectedRows:function(c){this._selections=[];if(b.Lang.isArray(c)&&this.data.size()>c.length){b.Array.each(c,function(d){var e=this.getRow(d);if(e){this._selections.push(e);e.addClass(this._classSelected);}},this);}return c;},_beforeResetDataSelect:function(){if(!this._selections||this._selections.length===0){return;}var e=this.get("selectedRows"),c=this.get("selectedCells"),d,f;this._selections=[];this.set("selected",null);this._clearAll(this._classSelected);if(this.get("selectionMode")==="row"&&e&&e.length>0){b.Array.each(e,function(g){if(g&&g.record){this._selections.push(g.record);}},this);}else{if(this.get("selectionMode")==="cell"&&c&&c.length>0){b.Array.each(c,function(g){if(g&&g.record&&g.columnIndex){this._selections.push({record:g.record,colIndex:g.columnIndex});}},this);}}},_afterResetDataSelect:function(){if(!this._selections||this._selections.length===0){return;}var d,e;var c=[];b.Array.each(this._selections,function(f){if(this.get("selectionMode")==="row"&&f){d=this.getRow(f);if(d){c.push(d);d.addClass(this._classSelected);}}else{if(this.get("selectionMode")==="cell"&&f){d=this.getRow(f.record),e=(d)?d.all("td").item(f.colIndex):null;if(d&&e){c.push(e);e.addClass(this._classSelected);}}}},this);this._selections=c;},_processNodeAction:function(h,g,j){var c=h.newVal,e,f,i,d;if(g==="highlight"){i=g+"Mode";d=this._classHighlight;}else{if(g==="select"){i="selectionMode";d=this._classSelected;}}if(this.get(i)=="cell"){e=c||null;f=h.prevVal||null;}else{if(this.get(i)=="row"){if(c){e=(c.get("tagName").search(/td/i)===0)?c.ancestor("tr"):(c.get("tagName").search(/tr/i)===0)?c:null;}f=h.prevVal;if(f){f=(f.get("tagName").search(/td/i)===0)?f.ancestor("tr"):(f.get("tagName").search(/tr/i)===0)?f:null;}}}if(f&&j){f.removeClass(d);}if(e){e.addClass(d);}return e;},_clearAll:function(d){var c=this.get("boundingBox").one("."+this.getClassName("data"));if(c){c.all("."+d).removeClass(d);}},_setHighlightMode:function(c){if(this._eventHandles.selectorHighlight){this._eventHandles.selectorHighlight.detach();}this._eventHandles.selectorHighlight=this.delegate("mouseover",function(f){var d=f.currentTarget;this.set("highlighted",d);},"tr td",this);this._clearAll(this._classHighlight);return c;},_setSelectionMode:function(d){var c=this;if(this._eventHandles.selectorSelect){this._eventHandles.selectorSelect.detach();}this._eventHandles.selectorSelect=this.delegate("click",function(g){var f=g.currentTarget;g.halt(true);c._clickModifiers={ctrlKey:g.ctrlKey,altKey:g.altKey,metaKey:g.metaKey,shiftKey:g.shiftKey,which:g.which,button:g.button};c.set("selected",f);},"tr td",c);this._clearAll(this._classSelected);return d;},_clearDOMSelection:function(){var c=(b.config.win.getSelection)?b.config.win.getSelection():(b.config.doc.selection)?b.config.doc.selection:null;if(c&&c.empty){c.empty();}if(c&&c.removeAllRanges){c.removeAllRanges();}}});b.DataTable.Selection=a;b.Base.mix(b.DataTable,[b.DataTable.Selection]);},"gallery-2012.09.26-20-36",{skinnable:true,requires:["base-build","datatable-base","event"]});