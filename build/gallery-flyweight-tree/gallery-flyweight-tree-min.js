YUI.add("gallery-flyweight-tree",function(a){var d=a.Lang,n=".",b="_default",q=a.ClassNameManager.getClassName,g=function(t){return q("flyweight-tree-node",t);},r=g(""),m=g("children"),h=g("collapsed"),c=g("expanded"),p=g("no-children"),s=g("first-child"),l=g("last-child"),o=g("loading"),f="_bypassProxy",e="value",j=a.Array,i,k;i=function(){this._pool={};this._initialValues={};};i.ATTRS={defaultType:{value:"FlyweightTreeNode"},dynamicLoader:{validator:d.isFunction,value:null}};i.prototype={_tree:null,_pool:null,_domEvents:null,_loadConfig:function(t){var u=this;u._tree={children:a.clone(t)};u._initNodes(this._tree);if(u._domEvents){a.Array.each(u._domEvents,function(v){u.after(v,u._afterDomEvent,u);});}},_initNodes:function(u){var t=this;a.Array.each(u.children,function(v){v._parent=u;v.id=v.id||a.guid();t._initNodes(v);});},_afterDomEvent:function(u){var t=this._poolFetchFromEvent(u);if(t){t.fire(u.type.split(":")[1],{domEvent:u.domEvent});this._poolReturn(t);}},_getTypeString:function(u){var t=u.type||b;if(!d.isString(t)){if(d.isObject(t)){t=t.NAME;}else{throw"Node contains unknown type";}}return t;},_poolFetch:function(w){var u,t=w._held,v=this._getTypeString(w);if(t){return t;}u=this._pool[v];if(u===undefined){u=this._pool[v]=[];}if(u.length){t=u.pop();t._slideTo(w);return t;}return this._createNode(w);},_poolReturn:function(t){if(t._node._held){return;}var u,v=this._getTypeString(t._node);u=this._pool[v];if(u){u.push(t);}},_createNode:function(v){var u,t=v.type||this.get("defaultType");if(d.isString(t)){t=a[t];}if(t){u=new t();if(u instanceof a.FlyweightTreeNode){u._slideTo({});a.Array.each(a.Object.keys(u._state.data),u._addLazyAttr,u);u._root=this;u._slideTo(v);return u;}}return null;},getRoot:function(){return this._poolFetch(this._tree);},_getHTML:function(){var u="",t=this.getRoot();t.forSomeChildren(function(v,w,x){u+=v._getHTML(w,x.length,0);});this._poolReturn(t);return u;},_findNodeByElement:function(u){var w=u.ancestor(n+k.CNAME_NODE,true).get("id"),v=null,t=function(x){if(x.id===w){v=x;return true;}if(x.children){return a.Array.some(x.children,t);}return false;};if(t(this._tree)){return v;}return null;},_poolFetchFromEvent:function(t){var u=this._findNodeByElement(t.domEvent.target);if(u){return this._poolFetch(u);}return null;},_forSomeCfgNode:function(v,u){u=u||this;var t=function(x,w){return a.Array.some(x.children||[],function(z,y){v.call(u,z,w,y);return t(z,w+1);});};return t(this._tree,0);},forSomeNodes:function(v,u){u=u||this;var t=function(w,x){w.forSomeChildren(function(z,y,A){if(v.call(u,z,x,y,A)===true){return true;}return t(z,x+1);});};return t(this.getRoot(),1);}};a.FlyweightTreeManager=i;k=a.Base.create("flyweight-tree-node",a.Base,[],{_node:null,_root:null,_getHTML:function(w,D,v){var B=this,t=this._node,A=this.getAttrs(),C="",y=t.template,u=t.children&&t.children.length,z=[r],x=this.constructor;while(!y){y=x.TEMPLATE;x=x.superclass.constructor;}t._rendered=true;if(u){if(A.expanded){t._childrenRendered=true;this.forSomeChildren(function(E,F,G){C+=E._getHTML(F,G.length,v+1);});z.push(c);}else{z.push(h);}}else{if(this._root.get("dynamicLoader")&&!t.isLeaf){z.push(h);}else{z.push(p);}}if(w===0){z.push(s);}if(w===D-1){z.push(l);}A.children=C;A.cname_node=z.join(" ");A.cname_children=m;return d.sub(y,A);},_slideTo:function(t){this._node=t;this._stateProxy=t;},forSomeChildren:function(x,w){var t=this._root,v=this._node.children,y,u;w=w||this;if(v&&v.length){j.some(v,function(A,z,B){y=t._poolFetch(A);u=x.call(w,y,z,B);t._poolReturn(y);return u;});}},_expandedGetter:function(){return this._node.expanded!==false;},_expandedSetter:function(x){var u=this,w=u._node,t=u._root,v=a.one("#"+w.id),y=t.get("dynamicLoader");w.expanded=x=!!x;if(y&&!w.isLeaf&&(!w.children||!w.children.length)){this._loadDynamic();return;}if(w.children&&w.children.length){if(x){if(!w._childrenRendered){u._renderChildren();}v.replaceClass(h,c);}else{v.replaceClass(c,h);}}},_loadDynamic:function(){var u=this,t=u._root;a.one("#"+this.get("id")).replaceClass(h,o);t.get("dynamicLoader").call(t,u,a.bind(u._dynamicLoadReturn,u));},_dynamicLoadReturn:function(v){var u=this,w=u._node,t=u._root;if(v){w.children=v;t._initNodes(w);u._renderChildren();}else{w.isLeaf=true;}a.one("#"+w.id).replaceClass(o,(w.isLeaf?p:c));},_renderChildren:function(){var t="",u=this._node,v=this.get("depth");u._childrenRendered=true;this.forSomeChildren(function(w,x,y){t+=w._getHTML(x,y.length,v+1);});a.one("#"+u.id+" ."+m).setContent(t);},hold:function(){return(this._node._held=this);},release:function(){this._node._held=null;this._root._poolReturn(this);return this;},getParent:function(){var t=this._node._parent;return(t?this._root._poolFetch(t):null);},getNextSibling:function(){var u=this._node._parent,v=(u&&u.children)||[],t=v.indexOf(this)+1;if(t===0||t>v.length){return null;}return this._root._poolFetch(v[t]);},getPreviousSibling:function(){var u=this._node._parent,v=(u&&u.children)||[],t=v.indexOf(this)-1;if(t<0){return null;}return this._root._poolFetch(v[t]);},toggle:function(){this.set("expanded",!this.get("expanded"));return this;},isRoot:function(){return this._root._tree===this._node;},_getStateVal:function(t){var u=this._node;if(this._state.get(t,f)||!u){return this._state.get(t,e);}if(u.hasOwnProperty(t)){return u[t];}return this._state.get(t,e);},_setStateVal:function(t,v){var u=this._node;if(this._state.get(t,f)||this._state.get(t,"initializing")||!u){this._state.add(t,e,v);}else{u[t]=v;}}},{TEMPLATE:'<div id="{id}" class="{cname_node}"><div class="content">{label}</div><div class="{cname_children}">{children}</div></div>',CNAME_NODE:r,CNAME_CHILDREN:m,CNAME_COLLAPSED:h,CNAME_EXPANDED:c,CNAME_NOCHILDREN:p,CNAME_FIRSTCHILD:s,CNAME_LASTCHILD:l,CNAME_LOADING:o,ATTRS:{root:{_bypassProxy:true,readOnly:true,getter:function(){return this._root;}},template:{validator:d.isString},label:{validator:d.isString,value:""},id:{readOnly:true},depth:{_bypassProxy:true,readOnly:true,getter:function(){var u=0,t=this._node;while(t._parent){u+=1;
t=t._parent;}return u-1;}},expanded:{_bypassProxy:true,getter:"_expandedGetter",setter:"_expandedSetter"}}});a.FlyweightTreeNode=k;},"gallery-2012.10.03-20-02",{requires:["base-base","base-build","classnamemanager"],skinnable:false});