YUI.add("gallery-bt-shortcut",function(b){var g=b.one("body"),r=b.one(".bt-shortcut-mask")||g.appendChild(b.Node.create('<div class="bt-shortcut-mask"></div>')),f="widthChange",c="heightChange",e="visibleChange",o=b.Bottle.Device.getTouchSupport(),l=b.Bottle.Device.getPositionFixedSupport(),m=o?g:b.one("html"),a,q,d=[],j,i,k={unveil:1,push:1},h={top:[0,-1,0.5,0],bottom:[0,1,0.5,1],left:[-1,0,0,0.5],right:[1,0,1,0.5]},n={"true":1,"false":1},p=b.Base.create("btshortcut",b.Widget,[b.WidgetParent,b.WidgetPosition,b.WidgetStack,b.Bottle.PushPop],{initializer:function(){if(!a){a=b.Bottle.Page.getCurrent();if(a){q=a.get("boundingBox");a.set("zIndex",p.ZINDEX_PAGE);}}d.push(this);this._bscEventHandlers=new b.EventHandle([this.after(f,this._updatePositionShow),this.after(c,this._updatePositionShow),this.before(e,this._beforeShowHide),this.after(e,this._doShowHide)]);this.get("contentBox").setStyle("display","block");this._updatePositionHide();this._updatePositionShow();},destructor:function(){this._bscEventHandlers.detach();delete this._bscEventHandlers;},renderUI:function(){var v=this.get("boundingBox"),u=this.get("contentBox"),s=v.get("offsetWidth")||u.get("offsetWidth"),t=v.get("offsetHeight")||u.get("offsetHeight");if(!this.get("height")&&t){this.set("height",t);}if(!this.get("width")&&s){this.set("width",s);}},scResize:function(s){if(!s&&(this.get("width")===b.Bottle.Device.getBrowserWidth())){return;}if(!s&&(this.get("height")===b.Bottle.Device.getBrowserHeight())){return;}if(!this.get("visible")&&!s){return;}this._updateFullSize();this._updatePositionShow();},_updateFullSize:function(){if(this.get("fullHeight")){this.set("height",b.Bottle.Device.getBrowserHeight(),{noAlign:true});}if(this.get("fullWidth")){this.set("width",b.Bottle.Device.getBrowserWidth(),{noAlign:true});}},getShowHidePosition:function(s){var t=s?0:1,u=h[this.get("showFrom")];return[Math.floor(u[2]*b.Bottle.Device.getBrowserWidth()+(t*u[0]-u[2])*this.get("width")),Math.floor(u[3]*b.Bottle.Device.getBrowserHeight()+(t*u[1]-u[3])*this.get("height"))+m.get("scrollTop")];},_updatePositionShow:function(t){var x=(t&&t.showFrom)?t.showFrom:this.get("showFrom"),s=(t&&(t.visible!==undefined))?t.visible:this.get("visible"),u=(t&&t.noAlign)?true:false,w=h[x],v;if(!s){return;}if(u){return;}q.setStyles({left:-w[0]*((t&&(t.attrName==="width"))?t.newVal:this.get("width"))+"px",top:-w[1]*((t&&(t.attrName==="height"))?t.newVal:this.get("height"))+"px"});v=this.getShowHidePosition(true);this.move(v[0],v[1]);},_updatePositionHide:function(u){var s=(this.get("action")==="unveil"),t=(u&&(u.visible!==undefined))?u.visible:this.get("visible"),v=this.getShowHidePosition(t||s);this.move(v[0],v[1]);},_displayMask:function(s){r.setStyle("display",s?"block":"none");},_doTransition:function(v,y,x,s,t){var u=this,w=b.merge(this.get("scTrans"),{left:y+"px"});w[t?"bottom":"top"]=x+"px";b.later(1,this,function(){v.transition(w,function(){if(s){s.apply(u);}});});},_beforeShowHide:function(t){var s=t.newVal;if(!j||!s||(j===this)){return;}i=this;t.halt();j.hide();},_doneShowHide:function(){var t=this.get("visible"),s=this.get("mask");if(s){this._displayMask(t);}this.set("disabled",t?false:true);this.set("zIndex",t?p.ZINDEX_SHOW:p.ZINDEX_HIDE);if(i){i.show();i=undefined;}},_doShowHide:function(v){var s=v.newVal,u=s?-1:0,x=h[this.get("showFrom")],t=this.get("boundingBox"),w;if(s){this.enable();this._updateFullSize();this._updatePositionHide({visible:false});j=this;}else{this._updatePositionShow({visible:true});if(this.get("mask")){this._displayMask(false);}j=undefined;}this.set("zIndex",p.ZINDEX_HIDE);w=[u*x[0]*this.get("width"),u*x[1]*this.get("height")];if(l&&a.get("nativeScroll")){a.each(function(y){if(y.get("headerFixed")){this._doTransition(y.get("headerNode"),w[0],w[1]);}if(y.get("footerFixed")){this._doTransition(y.get("footerNode"),w[0],-w[1],null,true);}},this);}this._doTransition(q,w[0],w[1],this._doneShowHide);if(this.get("action")!=="unveil"){w=this.getShowHidePosition(s);this._doTransition(t,w[0],w[1]);}}},{ATTRS:{action:{value:"unveil",lazyAdd:false,validator:function(s){return k[s]?true:false;},setter:function(s){if(s!==this.get("action")){this._updatePositionShow({action:s});}return s;}},showFrom:{value:"left",lazyAdd:false,validator:function(s){return h[s]?true:false;},setter:function(t){var u,v=this.get("contentBox"),s=h[t][0];if(t===this.get("showFrom")){return t;}this._updatePositionShow({showFrom:t});u=v.getData("full-height");if(n[u]){this.set("fullHeight",u==="true");}else{this.set("fullHeight",(s!==0)?true:false);}u=v.getData("full-width");if(n[u]){this.set("fullWidth",u==="true");}else{this.set("fullWidth",s===0);}return t;}},mask:{value:true,validator:b.Lang.isBoolean,setter:function(s){if(this.get("visible")){this._displayMask(s);}return s;}},scTrans:{value:{duration:0.5}},fullHeight:{validator:b.Lang.isBoolean,lazyAdd:false,setter:function(s){if(s){this.scResize();}return s;}},fullWidth:{validator:b.Lang.isBoolean,lazyAdd:false,setter:function(s){if(s){this.scResize();}return s;}}},HTML_PARSER:{mask:function(s){return(s.getData("mask")==="false")?false:true;},action:function(s){return s.getData("action");},showFrom:function(s){return s.getData("show-from");},scTrans:function(t){try{return b.JSON.parse(t.getData("cfg-sc-trans"));}catch(s){}}},ZINDEX_PAGE:100,ZINDEX_SHOW:200,ZINDEX_HIDE:10,getInstances:function(){return d;},getCurrent:function(){return j;}});b.Bottle.ShortCut=p;r.on(o?"gesturemoveend":"click",function(){j.hide();});r.on("gesturemovestart",function(s){s.preventDefault();});},"@VERSION@",{requires:["gallery-bt-page"]});