YUI.add("gallery-bt-photogrid",function(b){var c="widthChange",i="columnWidthChange",a="renderFinished",j=100,f="bpg_",h={COLUMN:f+"column",MODULE:f+"module"},g={COLUMN:'<div class="'+h.COLUMN+'"></div>'},e={vertical:1,horizontal:1},d=b.Base.create("btphotogrid",b.Widget,[b.Bottle.SyncScroll],{initializer:function(){this.parseImageData();this.set("syncScrollMethod",this._updateColumns);this.publish(a);this._bpgEventHandlers=this.after(i,this._updateColumns);},destructor:function(){this._bpgEventHandlers.detach();delete this._bpgEventHandlers;},renderUI:function(){this._updateColumns(true);},parseImageData:function(n,l){var k=l?this._bpgImages:[],m=this.get("photoNode"),o=n||this.get("contentBox");if(!l){this._bpgPending=0;}o.all(this.get("moduleNode")).each(function(r){var q={icon:r.getData("icon"),img:r.getData("img"),width:r.getData("width"),height:r.getData("height"),module:r.addClass(h.MODULE)},p=r.one(m);if(!q.icon){return;}q.load=b.Node.create('<img src="'+q.icon+'" />');if(p){p.append(q.load);}else{r.insert(q.load,0);}if(!q.height||!q.width){this._bpgPending+=1;q.load.once("load",function(s){var t=s.target;this.height=t.get("height");this.width=t.get("width");this._bpgPending-=1;},q);}k.push(q);},this);this._bpgImages=k;},_minColumn:function(){var k=9999,l;this.get("contentBox").all("> div").each(function(n){var m=n.get("offsetHeight");if(m<k){k=m;l=n;}});return l;},renderImages:function(){var k,l=j;if(this._bpgImages.length<=this._bpgRendered){this.syncScroll();this.fire(a);return;}k=this._bpgImages[this._bpgRendered];if(k.width){this._minColumn().append(k.module);this._bpgRendered+=1;l=1;}b.later(l,this,this.renderImages);},_updateColumns:function(q){var n=this.get("contentBox"),l=n.get("offsetWidth"),t=this.get("columnWidth"),p=Math.round(l/t),r=Math.floor(l/p),o=l-r*(p-1),m=g.COLUMN,k=q||(this._bpgColumns!==p),s;if(k){n.all(this.get("moduleNode")).remove();n.set("innerHTML","");this._bpgColumns=p;for(s=0;s<p;s++){n.append(m);}}n.all("> div").each(function(v,u){v.set("offsetWidth",u?r:o);});this.syncScroll();if(k){this._bpgRendered=0;this.renderImages();}}},{ATTRS:{columnWidth:{value:200,validator:function(k){return(k*1>0);},setter:function(k){return k*1;}},gridType:{value:"vertical",validator:function(k){return e[k]?true:false;}},moduleNode:{value:"> div",validator:b.Lang.isString},photoNode:{value:".img",validator:b.Lang.isString}},HTML_PARSER:{columnWidth:function(k){return k.getData("column-width");},gridType:function(k){return k.getData("grid-type");},moduleNode:function(k){return k.getData("module-node");},photoNode:function(k){return k.getData("photo-node");}}});b.namespace("Bottle").PhotoGrid=d;},"@VERSION@",{requires:["gallery-bt-syncscroll"]});