YUI.add("gallery-bt-overlay",function(c){var i=c.one("body"),h=c.one(".bt-overlay-mask")||i.appendChild(c.Node.create('<div class="bt-overlay-mask"></div>')),f="widthChange",e="heightChange",g="visibleChange",j=c.Bottle.Device.getTouchSupport(),d=j?i:c.one("html"),a=[],k,l={top:[0,-1],bottom:[0,1],left:[-1,0],right:[1,0]},b=c.Base.create("btoverlay",c.Widget,[c.WidgetParent,c.WidgetPosition,c.WidgetStack,c.Bottle.PushPop],{initializer:function(m){var n=this.get("contentBox").getData("mask");a.push(this);if(!m.zIndex){this.set("zIndex",200);}this.set("mask",(n?(n==="false"):this.get("fullPage"))?false:true);this._bscEventHandlers=new c.EventHandle([this.after(f,this._updatePositionShow),this.after(e,this._updatePositionShow),this.after(g,this._doShowHide)]);},destructor:function(){this._bscEventHandlers.detach();delete this._bscEventHandlers;},renderUI:function(){var o=this.get("boundingBox"),m=o.get("offsetWidth"),n=o.get("offsetHeight");if(!this.get("height")&&n){this.set("height",n);}if(!this.get("width")&&m){this.set("width",m);}this._updatePositionHide();this._updatePositionShow();},olResize:function(m){if(!this.get("visible")&&!m){return;}if(!m&&(this.get("width")===c.Bottle.Device.getBrowserWidth())&&(this.get("height")===c.Bottle.Device.getBrowserHeight())){return;}this._updateFullSize();this._updatePositionShow();},_updateFullSize:function(){if(this.get("fullPage")){this.set("width",c.Bottle.Device.getBrowserWidth(),{noAlign:true});this.set("height",c.Bottle.Device.getBrowserHeight(),{noAlign:true});}},_updatePositionShow:function(o){var n=(o&&(o.visible!==undefined))?o.visible:this.get("visible"),p=(o&&o.noAlign)?true:false,m=(n&&!p),q=m?this.getShowHideXY(true):0;if(m){this.move(q[0],q[1]);}},_updatePositionHide:function(n){var m=(n&&(n.visible!==undefined))?n.visible:this.get("visible"),o=m?0:this.getShowHideXY(false);if(!m){this.move(o[0],o[1]);}},_displayMask:function(m){h.setStyle("display",m?"block":"none");},_doTransition:function(o,q,p,m){var n=this;c.later(1,this,function(){o.transition(c.merge(this.get("olTrans"),{left:q+"px",top:p+"px"}),function(){if(m){m.apply(n);}});});},_doneShowHide:function(){var n=this.get("visible"),m=this.get("mask");if(m){this._displayMask(n);}if(!n){this.disable();}},getShowHideXY:function(n){var p=n?0:1,q=l[this.get("showFrom")],m=c.Bottle.Device.getBrowserWidth(),o=c.Bottle.Device.getBrowserHeight();return[p*m*q[0]+Math.floor((m-this.get("width"))/2),p*o*q[1]+Math.floor((o-this.get("height"))/2)+d.get("scrollTop")];},_doShowHide:function(n){var m=n.newVal;runthese=m&&this.enable()&&this._updateFullSize(),finalPos=this.getShowHideXY(m),node=this.get("boundingBox");if(m){this._updatePositionHide({visible:false});k=this;}else{this._updatePositionShow({visible:true});k=undefined;}this._doTransition(node,finalPos[0],finalPos[1],this._doneShowHide);}},{ATTRS:{showFrom:{value:"left",lazyAdd:false,validator:function(m){return l[m]?true:false;},setter:function(m){if(m===this.get("showFrom")){return m;}this._updatePositionShow({showFrom:m});return m;}},mask:{value:true,validator:c.Lang.isBoolean,setter:function(m){if(this.get("visible")){this._displayMask(m);}return m;}},olTrans:{value:{duration:0.5}},fullPage:{value:true,validator:c.Lang.isBoolean,lazyAdd:false,setter:function(m){if(m){this.olResize();}return m;}}},HTML_PARSER:{showFrom:function(m){return m.getData("show-from");},olTrans:function(n){try{return c.JSON.parse(n.getData("cfg-ol-trans"));}catch(m){}},fullPage:function(m){return(m.getData("full-page")==="false")?false:true;}},getInstances:function(){return a;},getCurrent:function(){return k;}});c.Bottle.Overlay=b;h.on(j?"gesturemoveend":"click",function(){k.hide();});h.on("gesturemovestart",function(m){m.preventDefault();});},"@VERSION@",{requires:["widget-position","widget-stack","gallery-bt-pushpop"]});